var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();define(["require","exports","es6-promise","underscore","./model","json!ekyna-cms/slide-types"],function(a,b,c,d,e,f){"use strict";c.polyfill();var g=c.Promise,h=function(){function b(){}return b.initialize=function(a){b.config=a,b.types={}},b.getType=function(c){return new g(function(d,e){if(b.types.hasOwnProperty(c))d(b.types[c]);else if(b.config.hasOwnProperty(c))try{a([b.config[c]],function(a){b.types[c]=new a,d(b.types[c])})}catch(f){e(f)}else e("Undefined type.")})},b}();h.initialize(f);var i=function(){function a(a){this.timeline=a}return a.prototype.show=function(){this.timeline.seek(0,!0),this.timeline.play()},a.prototype.hide=function(a){void 0===a&&(a=!1),a?(this.timeline.seek(0,!0),this.timeline.pause()):this.timeline.reverse()},a}(),j={id:null,types:{},ui:!0,auto:!0,debug:!1},k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.create=function(a){var c=new b;return c.init(a),c},b.prototype.init=function(a){var b=this;if(this.initialized=!1,this.root=document.getElementById(a.id),!this.root)return void console.log("Slide show's root element not found.");var c={};this.root.hasAttribute("data-config")&&(c=JSON.parse(this.root.getAttribute("data-config"))),this.options=d.defaults({},a,c,j),this.slides=[],this.busy=!1;for(var e=this.root.getElementsByClassName("cms-slides").item(0).children,f=[],k=function(a){var c=e.item(a);c.style.setProperty("display","none"),f.push(h.getType(c.getAttribute("data-type")).then(function(a){return new i(a.build(c,b))}))},l=0;l<e.length;l++)k(l);g.all(f).then(function(a){b.slides=a,b.buildUi(),b.transitionTo(0),b.initialized=!0,b.trigger("ekyna_cms.slide_show.initialized"),b.autoNext(),b.log("initialized")},function(a){console.log(a)})},b.prototype.autoNext=function(){var a=this;this.options.auto&&(this.autoTimeout&&clearTimeout(this.autoTimeout),this.autoTimeout=setTimeout(function(){a.nextSlide()},7e3))},b.prototype.transitionTo=function(a,b){var c=this;if(void 0===b&&(b=!1),(b||!this.busy)&&this.index!==a){if(!this.initialized)return void this.once("ekyna_cms.slide_show.initialized",function(){c.transitionTo(a,b)});this.index=a,this.log("show "+this.index);var d=this.slides[this.index];b?(this.current&&this.current.hide(!0),this.showSlide(d)):this.current?this.hideSlide(this.current,d):this.showSlide(d)}},b.prototype.nextSlide=function(){this.log("next");var a=this.index;a++,a>=this.slides.length&&(a=0),this.transitionTo(a)},b.prototype.prevSlide=function(){this.log("prev");var a=this.index;a--,a<0&&(a=this.slides.length-1),this.transitionTo(a)},b.prototype.hideSlide=function(a,b){var c=this;this.busy=!0,this.once("ekyna_cms.slide.hidden",function(){c.showSlide(b)}),a.hide()},b.prototype.showSlide=function(a){var b=this;if(this.busy=!0,this.once("ekyna_cms.slide.shown",function(){b.busy=!1,b.autoNext()}),this.current=a,this.current.show(),this.options.ui){for(var c=0;c<this.nav.children.length;c++){var d=this.nav.children.item(c);d.classList.remove("active")}this.nav.children.item(this.index).classList.add("active")}},b.prototype.buildUi=function(){var a=this;if(this.options.ui&&!(1>=this.slides.length)){this.nav=document.createElement("ul");for(var b=function(b){var d=document.createElement("li"),e=document.createElement("a");e.href="javascript: void(0)",e.innerText="&nbsp;",e.addEventListener("click",function(){a.transitionTo(b)}),d.appendChild(e),c.nav.appendChild(d)},c=this,d=0;d<this.slides.length;d++)b(d);var e=document.createElement("div");e.classList.add("cms-slide-show-nav"),e.appendChild(this.nav),this.root.appendChild(e);var f=document.createElement("a"),g=document.createElement("a");f.classList.add("cms-slide-show-prev"),f.href="javascript: void(0)",f.addEventListener("click",function(){a.prevSlide()}),this.root.appendChild(f),g.classList.add("cms-slide-show-next"),g.href="javascript: void(0)",g.addEventListener("click",function(){a.nextSlide()}),this.root.appendChild(g)}},b.prototype.log=function(a){this.options.debug&&console.log("[SlideShow]",a)},b}(e.Dispatcher);return k});