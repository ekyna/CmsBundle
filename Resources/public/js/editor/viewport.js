var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};define(["require","exports","jquery","backbone","underscore","./dispatcher"],function(a,b,c,d,e,f){"use strict";var g=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.defaults=function(){return{url:null,size:null}},b}(d.Model);b.ViewportModel=g;var h=function(a){function b(b){var c=this;b.tagName="div",b.attributes={id:"editor-viewport"},a.call(this,b),this.template=e.template('<iframe id="editor-viewport-frame" frameborder="0"></iframe>'),this.onControlsReloadClickHandler=function(a){return c.reload()},this.onControlsViewportClickHandler=function(a){return c.onViewportButtonClick(a)},this.onDocumentManagerNavigateHandler=function(a){return c.load(a)}}return __extends(b,a),b.prototype.initialize=function(a){e.bindAll(this,"resize","reload"),this.model.bind("change:size",this.resize),c(window).resize(this.resize)},b.prototype.reload=function(){this.iFrame.contentWindow.location.reload()},b.prototype.resize=function(){var a=this.model.get("size"),b={};if(a){var c=window.innerWidth,d=window.innerHeight;d-50>=a.height?(b.top=d/2-a.height/2+25,b.bottom=d/2-a.height/2-25):(b.top=50,b.height=a.height,b.marginTop=50,b.marginBottom=50),c>=a.width?(b.left=c/2-a.width/2,b.right=c/2-a.width/2):(b.left=0,b.width=a.width,b.marginLeft=50,b.marginRight=50)}else b={top:50,bottom:0,left:0,right:0};this.$el.removeAttr("style").css(b),f["default"].trigger("viewport.resize",{top:b.top,left:b.left})},b.prototype.onViewportButtonClick=function(a){var b=null,c=a.get("data");0<c.width&&0<c.height&&(b=a.get("rotate")?{width:c.height,height:c.width}:{width:c.width,height:c.height}),this.model.set("size",b)},b.prototype.render=function(){return this.$el.html(this.template()),this},b.prototype.initIFrame=function(a){var b=this;return this.iFrame=document.getElementById("editor-viewport-frame"),this.iFrame.onload=function(){f["default"].trigger("viewport_iframe.load",b.iFrame.contentWindow||b.iFrame,b.iFrame.contentDocument),b.iFrame.contentWindow.onbeforeunload=function(a){return f["default"].trigger("viewport_iframe.unload",a),a.returnValue?a.returnValue:void 0}},this.load(a),this},b.prototype.load=function(a){var b=document.createElement("a");b.href=a;for(var c,d={},e=b.search.replace("?","").split("&"),f=e.length,g=0;f>g;g++)e[g]&&(c=e[g].split("="),d[c[0]]=c[1]);if(!d.hasOwnProperty("cms-editor-enable")){d["cms-editor-enable"]=1,e=[];for(var h in d)d.hasOwnProperty(h)&&e.push(h+"="+d[h]);b.search="?"+e.join("&")}this.iFrame.src=b.href},b}(d.View);b.ViewportView=h});