define(["require","exports","es6-promise","ekyna-modal","../dispatcher"],function(a,b,c,d,e){"use strict";c.polyfill();var f=c.Promise,g=function(){function a(a,b){this.window=b,this.$element=a,this.updated=!1}return a.setup=function(){return new f(function(a,b){a()})},a.tearDown=function(){return new f(function(a,b){a()})},a.prototype.isUpdated=function(){return this.updated},a.prototype.edit=function(){this.destroyed=!1},a.prototype.save=function(){var a=this;return new f(function(b,c){if(a.isUpdated())throw"Plugin has updates.";b()})},a.prototype.destroy=function(){var a=this;return this.save().then(function(){a.modal&&(a.modal.close(),a.modal=null),a.destroyed=!0})},a.prototype.preventDocumentSelection=function(a){return!1},a.prototype.setUpdated=function(a){this.updated=a},a.prototype.openModal=function(a,b){e["default"].trigger("editor.set_busy"),this.modal=new d,this.modal.load({url:a,method:"GET"}),$(this.modal).on("ekyna.modal.response",function(a){"json"==a.contentType&&(a.preventDefault(),b(a))}).on("ekyna.modal.show",function(){e["default"].trigger("editor.unset_busy")}).on("ekyna.modal.hide",function(){e["default"].trigger("editor.unset_busy")})},a}();b.BasePlugin=g});