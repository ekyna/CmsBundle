define(["require","exports","es6-promise","ekyna-modal","../dispatcher","../document-manager"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c.polyfill();var g=c.Promise,h=function(){function a(a,b){this.window=b,this.$element=a,this.updated=!1}return a.setup=function(){return new g(function(a,b){a()})},a.tearDown=function(){return new g(function(a,b){a()})},a.prototype.isUpdated=function(){return this.updated},a.prototype.edit=function(){this.destroyed=!1},a.prototype.save=function(){var a=this;return new g(function(b,c){if(a.isUpdated())throw"Plugin has updates.";b()})},a.prototype.destroy=function(){var a=this;return this.save().then(function(){a.modal&&(a.modal.close(),a.modal=null),a.destroyed=!0})},a.prototype.preventDocumentSelection=function(a){return!1},a.prototype.setUpdated=function(a){this.updated=a},a.prototype.openModal=function(a,b){var c=this;e["default"].trigger("editor.set_busy"),this.modal=new d,this.modal.load({url:a,method:"GET"}),$(this.modal).on("ekyna.modal.response",function(a){if("json"==a.contentType){a.preventDefault(),f.BaseManager.parse(a.content);var d=new f.SelectionEvent;d.$element=c.$element,e["default"].trigger("document_manager.select",d),a.modal.close()}b&&b(a)}).on("ekyna.modal.show",function(){e["default"].trigger("editor.unset_busy")}).on("ekyna.modal.hide",function(){e["default"].trigger("editor.unset_busy")})},a}();b.BasePlugin=h});