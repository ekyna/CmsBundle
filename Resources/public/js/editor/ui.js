var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();define(["require","exports","jquery","backbone","underscore","bootstrap","./dispatcher","select2"],function(p,t,h,e,o,c,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarView=t.Toolbar=t.ControlGroupView=t.ControlGroup=t.SelectView=t.Select=t.SliderView=t.Slider=t.ButtonDropdownView=t.ButtonView=t.Button=t.Util=void 0,h.fn.select2.defaults.set("theme","bootstrap");function d(){}d.addEditorParameterToUrl=function(t){for(var e,n=document.createElement("a"),i=(n.href=t,{}),o=n.search.replace("?","").split("&"),r=o.length,s=0;s<r;s++)o[s]&&(i[(e=o[s].split("="))[0]]=e[1]);if(!i.hasOwnProperty("cms-editor-enable")){for(var l in i["cms-editor-enable"]=1,o=[],i)i.hasOwnProperty(l)&&o.push(l+"="+i[l]);n.search="?"+o.join("&")}return n.href},t.Util=d;var f,g={name:null,title:null,disabled:!1},m=(f=e.Model,__extends(n,f),n.prototype.defaults=function(){return n.buildDefaults()},n.prototype.validate=function(t,e){if(t=t||this.attributes,0==String(t.name).length)throw"Control.name is mandatory";if(0==String(t.title).length)throw"Control.event is mandatory"},n.prototype.enable=function(){return this.set("disabled",!1),this},n.prototype.disable=function(){return this.set("disabled",!0),this},n.prototype.getName=function(){return this.get("name")},n.prototype.getValue=function(){return this.get("value")},n.prototype.setValue=function(t,e){void 0===e&&(e=!1),this.set("value",t)},n.buildDefaults=function(t){return o.extend(g,{key:function(){for(var t="";t.length<8;){var e=Math.random();t+=e<.1?Math.floor(100*e):String.fromCharCode(Math.floor(26*e)+(.5<e?97:65))}return t}()},t)},n);function n(){return null!==f&&f.apply(this,arguments)||this}v=e.View,__extends(b,v);var v,y=b;function b(){return null!==v&&v.apply(this,arguments)||this}__extends(i,w=m),i.prototype.createView=function(){return new(0<this.get("choices").length?S:V)({model:this})},i.prototype.defaults=function(){return m.buildDefaults({size:"sm",theme:"default",icon:null,active:!1,spinning:!1,rotate:!1,confirm:null,event:null,choices:[],data:{}})},i.prototype.validate=function(t,e){if(w.prototype.validate.call(this,t,e),t=t||this.attributes,0==String(t.event).length)throw"Button.event is mandatory"},i.prototype.activate=function(){return this.set("active",!0),this},i.prototype.deactivate=function(){return this.set("active",!1),this},i.prototype.startSpinning=function(){return this.set("spinning",!0),this},i.prototype.stopSpinning=function(){return this.set("spinning",!1),this};var w,C=i;function i(){return null!==w&&w.apply(this,arguments)||this}t.Button=C;__extends(x,_=y),x.prototype.events=function(){return{click:"onClick"}},x.prototype.onClick=function(t){var e,n,i=this;t.preventDefault(),this.model.get("disabled")||(e=function(){r.default.trigger(i.model.get("event"),i.model,t)},(n=this.model.get("confirm"))&&0<n.length&&!confirm(n)||e())},x.prototype.render=function(){return this.$el.html(this.template(this.model.attributes)),this.$("button").prop("disabled",this.model.get("disabled")).toggleClass("active",this.model.get("active")).toggleClass("rotate",this.model.get("rotate")).find("span").toggleClass("cei-spin",this.model.get("spinning")),r.default.trigger("ui.control.render",this),this};var _,V=x;function x(t){var e=this;return t.tagName="span",t.attributes={class:"input-group-btn"},(e=_.call(this,t)||this).template=o.template('\n        <button type="button" class="btn btn-<%= theme %> btn-<%= size %>" title="<%= title %>">\n          <span class="cei cei-<%= icon %>"></span>\n        </button>\n        '),e.listenTo(e.model,"change",e.render),e}t.ButtonView=V;__extends(T,$=y),T.prototype.events=function(){return{"click li a":"onClick"}},T.prototype.onClick=function(t){var e=this;if(t.preventDefault(),!this.model.get("disabled")){var t=h(t.target).closest("a"),n=o.findWhere(this.model.get("choices"),{name:t.data("choice")});if(!n)throw"Choice not found";var t=function(){r.default.trigger(e.model.get("event"),e.model,n)},i=n.confirm;(!(i&&0<i.length)||confirm(i))&&t()}},T.prototype.render=function(){this.$el.html(this.template(this.model.attributes)),this.$("button").prop("disabled",this.model.get("disabled")).toggleClass("active",this.model.get("active")).toggleClass("rotate",this.model.get("rotate")).find("span").toggleClass("cei-spin",this.model.get("spinning"));var e=this.$("ul");return this.model.get("choices").forEach(function(t){t=h("<a></a>").attr("href","javascript:void(0)").data("choice",t.name).text(t.title).appendTo(e);h("<li></li>").append(t).appendTo(e)}),r.default.trigger("ui.control.render",this),this};var $,S=T;function T(t){var e=this;return t.tagName="span",t.attributes={class:"input-group-btn"},(e=$.call(this,t)||this).template=o.template('\n        <button type="button" class="btn btn-<%= theme %> btn-<%= size %> dropdown-toggle"\n                title="<%= title %>" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n          <span class="cei cei-<%= icon %>"></span> \n        </button>\n        <ul class="dropdown-menu"></ul>\n        '),e.listenTo(e.model,"change",e.render),e}t.ButtonDropdownView=S;__extends(s,G=m),s.prototype.defaults=function(){return m.buildDefaults({value:1,min:1,max:12})},s.prototype.initialize=function(t,e){},s.prototype.createView=function(){return new D({model:this})},s.prototype.validate=function(t,e){if(G.prototype.validate.call(this,t,e),t=t||this.attributes,0==String(t.event).length)throw"Slider.event is mandatory"},s.prototype.setValue=function(t,e){void 0===e&&(e=!1),this.set("value",t),e&&r.default.trigger(this.get("event"),this)};var G,C=s;function s(){return null!==G&&G.apply(this,arguments)||this}t.Slider=C;__extends(O,k=y),O.prototype.events=function(){return{"change input":"onInputChange"}},O.prototype.onModelChange=function(){this.$(".slider").slider({value:this.model.getValue()})},O.prototype.onInputChange=function(t){t.preventDefault(),this.model.setValue(this.$("input").val(),!0)},O.prototype.render=function(){this.$el.html(this.template(this.model.attributes));var n=this.$("input");return this.$(".slider").slider({value:this.model.get("value"),min:this.model.get("min"),max:this.model.get("max"),step:1,slide:function(t,e){n.val(e.value)},stop:function(){n.trigger("change")}}),r.default.trigger("ui.control.render",this),this};var k,D=O;function O(t){var e=this;return t.tagName="span",t.attributes={class:"input-group-slider"},(e=k.call(this,t)||this).template=o.template('\n            <label for="<%= key %>-input"><%= title %></label>\n            <input id="<%= key %>-input" name="<%= name %>" value="<%= value %>" \n                   type="number" min="<%= min %>" max="<%= max %>">\n            <div>\n              <div id="<%= key %>-slider" class="slider"></div>\n            </div>\n        '),e.listenTo(e.model,"change",e.onModelChange),e}t.SliderView=D;__extends(l,M=m),l.prototype.defaults=function(){return m.buildDefaults({width:null,value:null,choices:[]})},l.prototype.initialize=function(t,e){t.choices.length&&this.setChoices(t.choices)},l.prototype.createView=function(){return new B({model:this})},l.prototype.validate=function(t,e){if(M.prototype.validate.call(this,t,e),t=t||this.attributes,0==String(t.event).length)throw"Button.event is mandatory"},l.prototype.setChoices=function(t){var e;return this.set("choices",t),t.length&&((e=o.findWhere(t,{active:!0}))?this.setValue(e.value):(e=o.findWhere(t,{value:this.get("value")}))?e.active=!0:(t[0].active=!0,this.setValue(t[0].value))),this},l.prototype.getActiveChoice=function(){return o.findWhere(this.get("choices"),{active:!0})},l.prototype.setValue=function(e,t){if(void 0===t&&(t=!1),e!=this.getValue()){var n;if(this.get("choices").forEach(function(t){t.value==e?(t.active=!0,n=t):t.active=!1}),!n)throw'Value "'+e+'" not found in select choices.';this.set("value",e),t&&r.default.trigger(this.get("event"),this)}},l.prototype.select=function(t){this.setValue(t)};var M,C=l;function l(){return null!==M&&M.apply(this,arguments)||this}t.Select=C;__extends(E,j=y),E.prototype.events=function(){return{"change select":"onSelectChange"}},E.prototype.onSelectChange=function(t){t.preventDefault(),this.model.setValue(this.$("select").val(),!0)},E.prototype.render=function(){this.$el.html(this.template(this.model.attributes));var e=this.$("select").empty().prop("disabled",this.model.get("disabled")),t=this.model.get("width");return 0<t&&e.removeAttr("style").css({width:t}),this.model.get("choices").forEach(function(t){h("<option></option>").attr("value",t.value).prop("selected",t.active).prop("disabled",t.disabled).text(t.title).appendTo(e)}),r.default.trigger("ui.control.render",this),this};var j,B=E;function E(t){var e=this;return t.tagName="span",t.attributes={class:"input-group-select"},(e=j.call(this,t)||this).template=o.template('<select class="form-control" name="<%= name %>" title="<%= title %>"></select>'),e.listenTo(e.model,"change",e.render),e}t.SelectView=B;N=e.Model,__extends(P,N),P.prototype.defaults=function(){return{name:null,controls:new e.Collection}},P.prototype.addControl=function(t){return this.get("controls").add(t),this},P.prototype.getControl=function(t){return this.get("controls").findWhere({name:t})};var N,W=P;function P(){return null!==N&&N.apply(this,arguments)||this}t.ControlGroup=W;z=e.View,__extends(I,z),I.prototype.clear=function(){this.subViews.forEach(function(t){return t.remove()})},I.prototype.render=function(){var e=this;return this.clear(),this.model.get("controls").each(function(t){t=t.createView();e.$el.append(t.render().$el),e.subViews.push(t)}),this},I.prototype.remove=function(){return this.clear(),z.prototype.remove.call(this),this};var z,A=I;function I(t){var e=this;return t.tagName="div",t.attributes={class:"input-group"},(e=z.call(this,t)||this).subViews=[],e.listenTo(e.model,"add remove",e.render),e}t.ControlGroupView=A;U=e.Model,__extends(a,U),a.prototype.defaults=function(){return{id:null,name:null,classes:["vertical"],origin:{top:0,left:0},groups:new e.Collection}},a.prototype.getName=function(){return this.get("name")},a.prototype.hasGroup=function(e){return-1<this.get("groups").findIndex(function(t){return t.get("name")===e})},a.prototype.addGroup=function(t){return this.get("groups").add(t),this},a.prototype.getGroup=function(t){return this.get("groups").findWhere({name:t})},a.prototype.addControl=function(t,e){return this.hasGroup(t)||this.addGroup(new W({name:t})),this.getGroup(t).addControl(e),this},a.prototype.getControl=function(t,e){return this.hasGroup(t)?this.getGroup(t).getControl(e):null};var U,C=a;function a(){return null!==U&&U.apply(this,arguments)||this}t.Toolbar=C;q=e.View,__extends(u,q),u.prototype.clear=function(){this.subViews.forEach(function(t){return t.remove()})},u.prototype.position=function(t){var e={};t.left>window.innerWidth/2?(this.$el.addClass("right").removeClass("left"),e.right=window.innerWidth-t.left):(this.$el.addClass("left").removeClass("right"),e.left=t.left),t.top>window.innerHeight/2?(this.$el.addClass("bottom").removeClass("top"),e.bottom=window.innerHeight-t.top):(this.$el.addClass("top").removeClass("bottom"),e.top=t.top),this.$el.removeAttr("style").css(e)},u.prototype.applyOriginOffset=function(t){return this.position({top:t.top+this.model.get("origin").top,left:t.left+this.model.get("origin").left}),this},u.prototype.render=function(){var e=this;return this.clear(),this.model.get("groups").each(function(t){t=new A({model:t});e.$el.append(t.render().$el),e.subViews.push(t)}),this.position(this.model.get("origin")),this.postRender()},u.prototype.postRender=function(){return this.$(".dropdown-toggle").dropdown(),this.$("select").select2({width:"resolve"}),this},u.prototype.remove=function(){return this.clear(),q.prototype.remove.call(this),this};var q,y=u;function u(t){var e=this;return t.tagName="div",t.attributes={class:"editor-toolbar "+t.model.get("classes").join(" ")},0<String(t.model.get("id")).length&&o.extend(t.attributes,{id:t.model.get("id")}),(e=q.call(this,t)||this).subViews=[],e}t.ToolbarView=y});