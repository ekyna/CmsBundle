var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};define(["require","exports","jquery","backbone","underscore","./dispatcher"],function(a,b,c,d,e,f){"use strict";var g=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.defaults=function(){return{name:null,title:null,size:"sm",theme:"default",icon:null,active:!1,disabled:!1,spinning:!1,rotate:!1,confirm:null,event:null,choices:[],data:{}}},b.prototype.validate=function(a,b){if(a=a||this.attributes,0==String(a.name).length)throw"Button.name is mandatory";if(0==String(a.event).length)throw"Button.event is mandatory"},b.prototype.activate=function(){return this.set("active",!0),this},b.prototype.deactivate=function(){return this.set("active",!1),this},b.prototype.startSpinning=function(){return this.set("spinning",!0),this},b.prototype.stopSpinning=function(){return this.set("spinning",!1),this},b.prototype.enable=function(){return this.set("disabled",!1),this},b.prototype.disable=function(){return this.set("disabled",!0),this},b}(d.Model);b.Button=g;var h=function(a){function b(b){b.tagName="button",b.attributes={type:"button","class":"btn"},a.call(this,b),this.template=e.template('<span class="fa fa-<%= icon %>"></span>'),this.listenTo(this.model,"change",this.render)}return __extends(b,a),b.prototype.events=function(){return{click:"onClick"}},b.prototype.onClick=function(a){var b=this;a.preventDefault();var c=function(){f["default"].trigger(b.model.get("event"),b.model,b.model.get("data"))},d=this.model.get("confirm");d&&0<d.length?confirm(d)&&c():c()},b.prototype.render=function(){return this.$el.html(this.template({icon:this.model.get("icon")})).addClass("btn-"+this.model.get("size")).addClass("btn-"+this.model.get("theme")).attr("title",this.model.get("title")),this.$el.prop("disabled",this.model.get("disabled")),this.$el.toggleClass("active",this.model.get("active")),this.$el.toggleClass("rotate",this.model.get("rotate")),this.$("span").toggleClass("fa-spin",this.model.get("spinning")),this},b}(d.View);b.ButtonView=h;var i=function(a){function b(b){b.tagName="div",b.attributes={"class":"btn-group"},a.call(this,b),this.template=e.template('\n        <button type="button" class="btn btn-<%= theme %> btn-<%= size %> dropdown-toggle"\n                title="<%= title %>" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n          <span class="fa fa-<%= icon %>"></span> <span class="caret"></span>\n        </button>\n        <ul class="dropdown-menu"></ul>\n        '),this.listenTo(this.model,"change",this.render)}return __extends(b,a),b.prototype.events=function(){return{"click li a":"onClick"}},b.prototype.onClick=function(a){var b=this;a.preventDefault();var d=c(a.target).closest("a"),g=e.findWhere(this.model.get("choices"),{name:d.data("choice")});if(!g)throw"Choice not found";var h=function(){f["default"].trigger(g.event,b.model,g.data)},i=g.confirm;i&&0<i.length?confirm(i)&&h():h()},b.prototype.render=function(){this.$el.html(this.template(this.model.attributes)),this.$("button").prop("disabled",this.model.get("disabled")).toggleClass("active",this.model.get("active")).toggleClass("rotate",this.model.get("rotate")).find("span").toggleClass("fa-spin",this.model.get("spinning"));var a=this.$("ul");return this.model.get("choices").forEach(function(b){var d=c("<a></a>").attr("href","javascript:void(0)").data("choice",b.name).text(b.title).appendTo(a);c("<li></li>").append(d).appendTo(a)}),this},b}(d.View);b.ButtonDropdownView=i;var j=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.defaults=function(){return{name:null,buttons:new d.Collection}},b.prototype.addButton=function(a){return this.get("buttons").add(a),this},b.prototype.getButton=function(a){return this.get("buttons").findWhere({name:a})},b}(d.Model);b.ButtonGroup=j;var k=function(a){function b(b){b.tagName="div",b.attributes={"class":"btn-group"},a.call(this,b),this.subViews=[],this.listenTo(this.model,"add remove",this.render)}return __extends(b,a),b.prototype.clear=function(){this.subViews.forEach(function(a){return a.remove()})},b.prototype.render=function(){var a=this;return this.clear(),this.model.get("buttons").each(function(b){var c;c=0<b.get("choices").length?new i({model:b}):new h({model:b}),a.$el.append(c.render().$el),a.subViews.push(c)}),this},b.prototype.remove=function(){return this.clear(),a.prototype.remove.call(this),this},b}(d.View);b.ButtonGroupView=k;var l=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.defaults=function(){return{id:null,classes:["vertical"],origin:{top:0,left:0},groups:new d.Collection}},b.prototype.hasGroup=function(a){return-1<this.get("groups").findIndex(function(b){return b.get("name")===a})},b.prototype.addGroup=function(a){return this.get("groups").add(a),this},b.prototype.getGroup=function(a){return this.get("groups").findWhere({name:a})},b.prototype.addButton=function(a,b){return this.hasGroup(a)||this.addGroup(new j({name:a})),this.getGroup(a).addButton(b),this},b.prototype.getButton=function(a,b){return this.getGroup(a).getButton(b)},b}(d.Model);b.Toolbar=l;var m=function(a){function b(b){b.tagName="div",b.attributes={"class":"editor-toolbar "+b.model.get("classes").join(" ")},0<String(b.model.get("id")).length&&e.extend(b.attributes,{id:b.model.get("id")}),a.call(this,b),this.subViews=[]}return __extends(b,a),b.prototype.clear=function(){this.subViews.forEach(function(a){return a.remove()})},b.prototype.position=function(a){var b={};a.left>window.innerWidth/2?(this.$el.addClass("right").removeClass("left"),b.right=window.innerWidth-a.left):(this.$el.addClass("left").removeClass("right"),b.left=a.left),a.top>window.innerHeight/2?(this.$el.addClass("bottom").removeClass("top"),b.bottom=window.innerHeight-a.top):(this.$el.addClass("top").removeClass("bottom"),b.top=a.top),this.$el.removeAttr("style").css(b)},b.prototype.applyOriginOffset=function(a){return this.position({top:a.top+this.model.get("origin").top,left:a.left+this.model.get("origin").left}),this},b.prototype.render=function(){var a=this;return this.clear(),this.model.get("groups").each(function(b){var c=new k({model:b});a.$el.append(c.render().$el),a.subViews.push(c)}),this.position(this.model.get("origin")),this},b.prototype.postRender=function(){c(".dropdown-toggle").dropdown()},b.prototype.remove=function(){return this.clear(),a.prototype.remove.call(this),this},b}(d.View);b.ToolbarView=m});